# 简化DPFPSI协议使用说明

## 概述
简化后的DPFPSI协议专注于使用DPF函数获取Server生成的随机数据中关于Q中行号的label，其中：
- **Server**: 生成随机数据和对应的label
- **Client**: 持有Q（查询行号集合），请求特定行号的label
- **AidServer**: 辅助实现DPF过程

## 文件说明

### 1. Server_cli.cpp
**功能**: 生成随机数据和label，等待Client请求
**主要改进**:
- 生成随机数据集和对应的label
- 使用map存储label以便快速查找
- 简化的网络通信协议
- 中文输出信息

**使用方法**:
```bash
./Server_cli -t 4 -l 10 -i 1
```

### 2. Client_cli.cpp  
**功能**: 持有Q并请求特定行号的label
**主要改进**:
- 支持指定查询行号（-q参数）
- 默认查询行号：0, 1, 2
- 简化的DPF协议请求
- 中文输出信息

**使用方法**:
```bash
# 使用默认查询行号
./Client_cli -t 4 -l 10 -i 1

# 指定查询行号
./Client_cli -t 4 -l 10 -i 1 -q "0,1,2,5,10"
```

### 3. AidServer_cli.cpp
**功能**: 辅助实现DPF过程
**主要改进**:
- 简化的辅助协议
- 专注于DPF过程支持
- 中文输出信息

**使用方法**:
```bash
./AidServer_cli -t 4 -l 10 -i 1
```

## 参数说明

| 参数 | 长参数 | 说明 | 默认值 |
|------|--------|------|--------|
| -t | --threads | 线程数 | 4 |
| -l | --log | 数据集大小(2^log) | 10 |
| -i | --ins | 交集大小 | 1 |
| -q | --query | 查询行号(逗号分隔) | 0,1,2 |

## 运行顺序

1. **启动AidServer** (辅助服务器):
```bash
./AidServer_cli -t 4 -l 10 -i 1
```

2. **启动Server** (数据服务器):
```bash
./Server_cli -t 4 -l 10 -i 1
```

3. **启动Client** (查询客户端):
```bash
./Client_cli -t 4 -l 10 -i 1 -q "0,1,2,5,10"
```

## 协议流程

1. **Server**: 生成随机数据集和对应的label，等待连接
2. **AidServer**: 启动辅助服务，准备支持DPF协议
3. **Client**: 连接Server，使用DPF协议请求Q中行号对应的label
4. **AidServer**: 辅助完成DPF计算过程
5. **Client**: 获得请求的label

## 输出文件

所有时间统计信息会保存到 `time.txt` 文件中，包括：
- 数据生成/准备时间
- 在线处理时间  
- 总处理时间
- 数据集大小和查询参数

## 简化特点

1. **专注核心功能**: 移除了复杂的PSI协议，专注于DPF函数
2. **清晰的角色分工**: Server生成数据，Client持有Q，AidServer辅助
3. **简化的通信**: 减少了不必要的网络通信
4. **中文界面**: 所有输出信息使用中文，便于理解
5. **灵活查询**: 支持指定任意查询行号

## 注意事项

- 确保三个程序按顺序启动
- 网络端口配置：Server(8000), AidServer(50001,50002)
- 查询行号应在数据集范围内
- 时间统计文件会追加写入，注意清理旧数据
